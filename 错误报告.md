# PCS Python 测试用例错误报告

## 报告生成时间
2024年

## 概述
本报告列出了在 `pcs/pcs_py/` 目录下所有测试用例文件中发现的代码错误和问题。

---

## 1. 未使用的变量

### 1.1 testPowerShell.py (第36行)
**问题描述：** 定义了变量 `state` 但从未使用

**代码位置：**
```python
def process(self):
    Step("Process")
    state = ""  # 未使用的变量
    suspendStr = self.device1.execute_shell_command("power-shell suspend")
```

**修复建议：** 删除该行或使用该变量

---

### 1.2 testPowerWakeUp.py (第36行)
**问题描述：** 定义了变量 `state` 但从未使用

**代码位置：**
```python
def process(self):
    Step("Process")
    state = ""  # 未使用的变量
    suspendStr = self.device1.execute_shell_command("power-shell suspend")
```

**修复建议：** 删除该行或使用该变量

---

### 1.3 testSDCardMount.py (第40行)
**问题描述：** 变量 `rmountResult` 被赋值但从未使用

**代码位置：**
```python
for mountItem in mountList:
    if '/mnt/data/external' in mountItem:
        sdCardList.append(mountItem.split()[0])
        rmountResult = self.device1.execute_shell_command("umount " + mountItem.split()[-1])  # 未使用的变量
```

**修复建议：** 如果不需要返回值，可以直接调用命令而不赋值

---

### 1.4 testSelinuxFileLable.py (第42-46行)
**问题描述：** 变量 `defaultDirectories` 被定义但从未使用

**代码位置：**
```python
defaultLabels = ['u:object_r:rootfs:s0', 'u:object_r:configfs:s0', ...]
defaultDirectories = ['/', '/lost\+found', '/bin', ...]  # 未使用的变量
errorList = []
```

**修复建议：** 如果不需要该变量，删除定义；如果需要，在代码中使用它

---

### 1.5 testSystemCoreInternetPermission.py (第38行)
**问题描述：** 变量 `systemcore` 被定义并添加元素，但从未使用

**代码位置：**
```python
errorList = []
systemcore = []  # 未使用的变量
initFileList = self.device1.execute_shell_command("ls /system/etc/init").strip().split()
...
    if 'apl' in service and service['apl'] == 'system_core':
        self.log.info(initFile)
        systemcore.append(initFile)  # 添加了元素但从未使用
```

**修复建议：** 如果不需要该变量，删除定义和相关代码；如果需要用于日志或调试，使用它

---

## 2. 路径错误

### 2.1 testSysCapNameOnly.py (第36行)
**问题描述：** 使用了相对路径而不是绝对路径

**代码位置：**
```python
def process(self):
    Step("Process")
    sysCapsStr = self.device1.execute_shell_command("cat ./system/etc/param/syscap.para")  # 路径错误
```

**问题分析：** 
- 在设备上执行命令时，应该使用绝对路径 `/system/etc/param/syscap.para`
- 相对路径 `./system/etc/param/syscap.para` 可能无法正确访问文件

**修复建议：** 
```python
sysCapsStr = self.device1.execute_shell_command("cat /system/etc/param/syscap.para")
```

**参考：** 其他文件如 `testCommandWukong.py` (第34行) 和 `testMinimumComponentSet.py` (第36行) 都正确使用了绝对路径

---

## 3. 引用不存在的属性

### 3.1 PermissionUtils.py (第30行)
**问题描述：** 方法 `isInPermissionList` 引用了不存在的属性 `self.permissionList`

**代码位置：**
```python
class PermissionUtils:
    systemPermissionList = []
    userPermissionList = []

    def __init__(self):
        self.systemPermissionList.clear()
        self.userPermissionList.clear()
        self.getAllPermissions()

    def isInPermissionList(self, permission):
        return permission in self.permissionList  # self.permissionList 不存在
```

**问题分析：**
- 类中只定义了 `systemPermissionList` 和 `userPermissionList`
- 没有定义 `permissionList` 属性
- 该方法可能永远不会被调用（未在其他文件中找到调用），或者需要修复

**修复建议：**
1. 如果该方法不需要，删除它
2. 如果需要，修改为检查两个列表：
   ```python
   def isInPermissionList(self, permission):
       return permission in self.systemPermissionList or permission in self.userPermissionList
   ```
3. 或者合并两个列表：
   ```python
   def isInPermissionList(self, permission):
       return permission in (self.systemPermissionList + self.userPermissionList)
   ```

---

## 4. 方法定义问题

### 4.1 sysCapUtils.py (第21行)
**问题描述：** `getAllSysCaps` 方法定义不正确，缺少 `self` 参数或 `@staticmethod` 装饰器

**代码位置：**
```python
class sysCapUtils:

    def getAllSysCaps(sysCapsStr):  # 缺少 self 或 @staticmethod
        time.sleep(1)
        sysCapsList = []
        for sysCapStr in sysCapsStr.splitlines():
            if sysCapStr.startswith('const.SystemCapability.') and sysCapStr.endswith('=true'):
                sysCapsList.append(sysCapStr[6 : len(sysCapStr)-5])
        return sysCapsList
```

**问题分析：**
- 这是一个类方法，但没有 `self` 参数
- 从使用方式看（`sysCapUtils.getAllSysCaps(sysCapsStr)`），它被当作静态方法调用
- 应该使用 `@staticmethod` 装饰器或添加 `self` 参数

**修复建议：**
```python
class sysCapUtils:

    @staticmethod
    def getAllSysCaps(sysCapsStr):
        time.sleep(1)
        sysCapsList = []
        for sysCapStr in sysCapsStr.splitlines():
            if sysCapStr.startswith('const.SystemCapability.') and sysCapStr.endswith('=true'):
                sysCapsList.append(sysCapStr[6 : len(sysCapStr)-5])
        return sysCapsList
```

---

## 5. 代码风格问题

### 5.1 testPowerShell.py (第49行)
**问题描述：** `teardown` 方法前缺少空行

**代码位置：**
```python
        assert 'Set Mode: 603' in setModeStr
    def teardown(self):  # 方法前缺少空行
        Step("Teardown")
```

**修复建议：** 在方法定义前添加空行，保持代码风格一致

---

### 5.2 testPowerWakeUp.py (第41行)
**问题描述：** `teardown` 方法前缺少空行

**代码位置：**
```python
        assert 'SuspendDevice is called' in suspendStr
    def teardown(self):  # 方法前缺少空行
        Step("Teardown")
```

**修复建议：** 在方法定义前添加空行

---

### 5.3 testSysCapNameOnly.py (第41行)
**问题描述：** `teardown` 方法前缺少空行

**代码位置：**
```python
        assert len(sysCapsList) == len(set(sysCapsList))
    def teardown(self):  # 方法前缺少空行
        Step("Teardown")
```

**修复建议：** 在方法定义前添加空行

---

## 6. 潜在问题

### 6.1 testSDCardMount.py (第45行)
**问题描述：** 执行 `reboot` 命令后立即执行后续命令，可能导致设备未完全重启

**代码位置：**
```python
rebootResult = self.device1.execute_shell_command("reboot")
mountResult = self.device1.execute_shell_command("df -h")  # 可能设备还未重启完成
```

**修复建议：** 在 `reboot` 后添加等待时间或重试机制，确保设备完全重启后再执行后续命令

---

## 错误统计

| 错误类型 | 数量 | 严重程度 |
|---------|------|---------|
| 未使用的变量 | 5 | 低 |
| 路径错误 | 1 | 高 |
| 引用不存在的属性 | 1 | 高 |
| 方法定义问题 | 1 | 中 |
| 代码风格问题 | 3 | 低 |
| 潜在问题 | 1 | 中 |
| **总计** | **12** | - |

---

## 修复优先级

### 高优先级（必须修复）
1. **testSysCapNameOnly.py** - 路径错误（可能导致测试失败）
2. **PermissionUtils.py** - 引用不存在的属性（运行时错误）

### 中优先级（建议修复）
3. **sysCapUtils.py** - 方法定义问题（代码规范）
4. **testSDCardMount.py** - 潜在的重启时序问题

### 低优先级（可选修复）
5. 删除未使用的变量（代码清理）
6. 添加方法间的空行（代码风格）

---

## 备注

- 所有测试用例文件都遵循了统一的代码风格和结构
- 大部分错误是代码质量问题，不会影响功能，但建议修复以提高代码质量
- 建议在修复后进行完整的测试验证

